# Chapter 2: Prepare Phase

## 1. Data sources

For this analysis, I am using two publicly available datasets, wich provide different perspectives on user behaviors and relationships with their smart devices:

- **A) Fitbit Fitness Tracker Data (Kaggle)**

Available [here](https://www.kaggle.com/datasets/arashnic/fitbit), this dataset, recommended by Bellabeat's COO, was generated by respondents to a distributed survey via Amazon Mechanical Turk between March 12, 2016, and May 12, 2016. Thirty eligible Fitbit users consented to share their personal tracker data. Individual reports can be parsed by export session ID or timestamp.

However, because of this dataset's limitations (small sample size, data collected in 2016, and lack of gender differentiation), I looked for a complementary data source (see below).

- **B) 'A dataset for studying the relationship between humans and their smart devices' (MDPI)**

Available [here](https://www.mdpi.com/2306-5729/9/4/56), this dataset includes survey responses from over 500 individuals, collected between May and July 2020. The larger, more recent sample makes it more representative and relevant. Additionally, the survey asked respondents whether they were male (1) or female (2), which makes it better suited to Bellabeat’s focus on women. Lastly, this dataset adds a psychological dimension to the analysis by exploring user attitudes and interactions with their smart devices, which is nice addition to the Fitbit data.

## 2. Data organization

During my exploration of the Fitbit datasets, I found out that the data unzipped into 2 separate folders, called:
"`Fitabase Data 3.12.16 - 4.11.16`" 
and 
"`Fitabase Data 4.12.16 - 5.12.16`".
I noticed that many files from the first Fitbit folder (containing 11 csv files) seemed to have a matching filename in the second Fitbit folder (containing 18 csv files), only with different time periods. I decided to investigate further:

First, I used the command line to list the filenames from both Fitbit folders and saved them into text files using the following commands:

```bash
ls > filelist_1.txt
ls > filelist_2.txt
```

Then I compared the filenames manually using Google Sheets. I imported both text files into separate columns and applied a matching formula to check for identical filenames:

```excel
=IF(ISNUMBER(MATCH(A1, B:B, 0)), "Match", "No Match")
```

*Quick reminder on how the `MATCH()` function works in Excel and Google Sheets:*

* `MATCH()` checks if the value in cell A1 exists anywhere in Column B. The 0 at the end means it looks for an exact match.

* If a match is found, `MATCH()` returns the row number where it found the value in Column B. If no match is found, it returns an error (`#N/A`).

* `ISNUMBER()` checks if the return value is a number, and `IF()` evaluates whether `ISNUMBER()` returns `TRUE` or `FALSE`.

I also applied conditional formatting in Google Sheets to highlight cells with matching filenames, which confirmed that all the 11 files from the first folder had "twin" files in the second folder. The second folder contained an additional 7 files not found in the first.

Once the filenames were verified, I concatenated the matching twin files using R and stored the combined files in a new folder named "`FitBit_Complete_Data`", (along with the remaining files from Fitbit folder 2 that had no matching filenames). 

Here's part of my [code](BELLABEAT_Combining_Twin_Files.R) for file concatenation:

```r
# List files in each folder
files1 <- list.files(folder1, pattern = "*.csv", full.names = TRUE)
files2 <- list.files(folder2, pattern = "*.csv", full.names = TRUE)

# Looping through files to look for matching filenames ("twins")
for (file in unique(c(basename(files1), basename(files2)))) {
 
  # If there are twin files in folders 1 and 2, concat files
  if (file %in% basename(files1) & file %in% basename(files2)) {
    data1 <- read_csv(file.path(folder1, file))
    data2 <- read_csv(file.path(folder2, file))
   
    # Combine the data
    combined_data <- rbind(data1, data2)
   
    # Save the combined file in the folder "FitBit_Complete_Data"
    write_csv(combined_data, here("BELLABEAT", "FitBit_Complete_Data", paste0("combined_", file)))
   
  } else {
    # Copy non-matching files to the folder "FitBit_Complete_Data" as well
    if (file %in% basename(files1)) {
      file.copy(file.path(folder1, file), here("BELLABEAT", "FitBit_Complete_Data", file))
    } else {
      file.copy(file.path(folder2, file), here("BELLABEAT", "FitBit_Complete_Data", file))
    }
  }
}

```
    
To confirm the final file organization, I checked if all required files were present in the new, unified folder with the following command line:

```bash
cd FitBit_Complete_Data/
ls > total_files.txt
cat total_files.txt
wc -l total_files.txt
```

This process resulted in a total of 18 Fitbit .csv files (11 combined "twin" files and 7 additional files from the second folder).

Now, the Fitbit dataset is fully organized, with all the files stored in one unified folder called `Fitbit_Complete_Data`.
As for the survey data, it is stored separately in a folder called `Questionnaire_Data` in the same directory. 
As a result, I now have two organized folders for both datasets: one folder for the Fitbit users and one for the survey data.

#### A) "Fitbit_Complete_Data" folder

Contains 18 .csv files with data from March 12 to May 12, 2016, organized as follows:

File                     | Description
-------------------------|-----------------------------
`dailyActivity_merged.csv` | Daily summary of activity levels, steps, and calories burned.
`heartrate_seconds_merged.csv` | Second-by-second heart rate data.
`hourlyCalories_merged.csv` | Hourly calorie data.
`hourlyIntensities_merged.csv` | Hourly intensity data.
`hourlySteps_merged.csv` | Hourly step data.
`minuteCaloriesNarrow_merged.csv` | Narrow minute-level calorie data.
`minuteIntensitiesNarrow_merged.csv` | Narrow minute-level intensity data.
`minuteMETsNarrow_merged.csv` | Narrow minute-level MET data.
`minuteSleep_merged.csv` | Minute-level sleep data.
`minuteStepsNarrow_merged.csv` | Narrow minute-level step data.
`weightLogInfo_merged.csv` | Weight log information.
`dailyCalories_merged.csv` | Daily calorie data.
`dailyIntensities_merged.csv` | Daily intensity data.
`dailySteps_merged.csv` | Daily step data.
`minuteCaloriesWide_merged.csv` | Wide minute-level calorie data.
`minuteIntensitiesWide_merged.csv` | Wide minute-level intensity data.
`minuteStepsWide_merged.csv` | Wide minute-level step data.
`sleepDay_merged.csv` | Daily summary of sleep data.

#### B) "Questionnaire_Data" folder

Contains:
- A 'Data Report' PDF file providing the research context, names of the survey authors, etc.
- The original blank survey questionnaire (PDF)
- The actual dataset in Excel format.
  
The Excel file contains data collected from over 500 individuals between May and July 2020. It focuses on user opinions and interactions with their smart devices:

File                     | Description
-------------------------|-----------------------------
`Anonymized_UserRelationshipWithTheirSmartDevice_Dataset.xlsx` | User opinions and interactions with their smart devices.

The Excel file is in long (narrow) format.

## 3. Credibility and limitations

### A) Fitbit dataset

#### Context and authors

The Fitbit dataset was compiled and made publicly available by [Möbius](https://www.kaggle.com/arashnic) on [Kaggle](https://www.kaggle.com/datasets/arashnic/fitbit). The data was collected through Fitbit’s API, and generated by respondents to a distributed survey via Amazon Mechanical Turk between March 12, 2016, and May 12, 2016. Thirty eligible Fitbit users consented to share their personal tracker data. 

#### Limitations

The Fitbit dataset has four key limitations:

- a) Small sample size (30 users): not representative, makes it difficult to draw conclusions that can be applied to a larger population;
- b) Outdated data (collected in 2016): the dataset may not reflect current trends in smart device usage;
- c) Lack of gender differentiation: since Bellabeat focuses on women's health and wellness, the lack of gender-specific data makes it less relevant for this business task.
- d) Potential bias: Fitbit users might be more health-conscious or active than the general population, which could introduce bias in the analysis.


### B) Survey dataset

#### Context and authors

The survey dataset was conducted by [Francesco Lelli](https://francescolelli.info/) (Professor at Tilburg University) and [Heidi Toivonen](https://www.heiditoivonen.com/) (PostDoc at Ghent University) using the Qualtrics platform. Data was collected from over 500 participants between May and July 2020, with no specific pre-selection of respondents. 
#### Strengths

- a) Larger sample size (500+ participants): provides a more robust and representative perspective;
- b) More recent data (collected in 2020): provides a more recent perspective;
- c) Gender differentiation: includes data that distinguishes between men and women (coded as '1' or '2'), which makes it more relevant to Bellabeat’s focus on women;
- d) Ethical approval: received a stamp of ethical approval (IRB EXE 2020-007) for data collection integrity and participant protection.
- e) Global collection: distributed globally, so there was a diverse pool of respondents, which adds to the dataset's generalizability.
- f) Psychological insights: adds an understanding of how users feel about and interact with their smart devices.

#### Limitations

However, the survey respondents might represent a specific demographic and could limit the generalization of the results.


## 4. Data integrity and privacy

Both datasets are GDPR-compliant and do not contain any personally identifiable information. They are publicly available and licensed for open use (Fitbit data via Kaggle and the survey data via MDPI's open access). These datasets have been downloaded and stored locally to ensure privacy and data integrity before moving to the cleaning phase.

